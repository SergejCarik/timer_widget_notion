<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Compact Timer</title>
<style>
  body {
    margin:0;
    font-family: 'Segoe UI', Roboto, system-ui, sans-serif;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background: linear-gradient(135deg,#e0f7fa,#ffffff);
  }
  .timer {
    display:flex;
    flex-direction:column;
    align-items:center;
    background:white;
    padding:12px 16px;
    border-radius:16px;
    box-shadow:0 6px 24px rgba(0,0,0,0.12);
    min-width:280px;
  }
  .timer-row {
    display:flex;
    align-items:center;
    gap:10px;
    width:100%;
  }
  input {
    width:60px;
    padding:6px 8px;
    border:1px solid #ddd;
    border-radius:8px;
    text-align:center;
    font-size:1rem;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
  }
  button {
    padding:6px 12px;
    border:none;
    border-radius:8px;
    background: linear-gradient(90deg,#00c6ff,#0072ff);
    color:white;
    font-weight:500;
    cursor:pointer;
    transition:0.2s;
  }
  button:hover { background: linear-gradient(90deg,#0072ff,#00c6ff); }
  #display {
    min-width:60px;
    text-align:center;
    font-weight:bold;
    font-size:1rem;
  }
  .bar {
    width:100%;
    height:6px;
    background:#eee;
    border-radius:6px;
    overflow:hidden;
    margin-top:8px;
  }
  .fill {
    height:100%;
    width:0;
    background: linear-gradient(90deg,#00c6ff,#0072ff);
    transition: width 1s linear;
  }
</style>
</head>
<body>
<div class="timer">
  <div class="timer-row">
    <input id="timeInput" type="text" placeholder="2 or 1:30">
    <button id="startBtn">Start</button>
    <div id="display">00:00</div>
  </div>
  <div class="bar"><div class="fill" id="fill"></div></div>
</div>

<script>
let timer=null, total=0, startTime=0;
const display=document.getElementById('display');
const fill=document.getElementById('fill');

function parseTime(input){
  input=input.trim();
  if(!input) return 0;
  if(/^\d+$/.test(input)) return parseInt(input,10)*3600; // только число = часы
  const parts=input.split(':').map(x=>parseInt(x,10)||0);
  if(parts.length===2) return parts[0]*3600+parts[1]*60;
  return 0;
}

function format(sec){
  const h=Math.floor(sec/3600), m=Math.floor(sec%3600/60);
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}`;
}

function tick(){
  const elapsed=Math.floor((Date.now()-startTime)/1000);
  const remaining=Math.max(0,total-elapsed);
  display.textContent=format(remaining);
  fill.style.width=(100 - remaining/total*100) + '%';
  if(remaining<=0){ clearInterval(timer); flash(); beep(); }
}

function flash(){
  document.body.style.background='linear-gradient(135deg,#ffe6e6,#ffffff)';
  setTimeout(()=>document.body.style.background='linear-gradient(135deg,#e0f7fa,#ffffff)',800);
}

function beep(){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine'; o.frequency.setValueAtTime(800,ctx.currentTime);
    g.gain.setValueAtTime(0.1,ctx.currentTime);
    o.connect(g).connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime+0.3);
  }catch(e){}
}

document.getElementById('startBtn').onclick=()=>{
  const t=parseTime(document.getElementById('timeInput').value);
  if(!t){ alert('Введите часы или ч:мм'); return; }
  total=t; startTime=Date.now();
  clearInterval(timer);
  tick(); timer=setInterval(tick,1000);
};
</script>
</body>
</html>
