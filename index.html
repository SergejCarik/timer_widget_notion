<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Timer</title>
<style>
  body {
    margin: 0; font-family: system-ui, sans-serif;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    height: 100vh; background: #fafafa;
  }
  .timer-box {
    text-align: center; padding: 20px 30px;
    border-radius: 16px; box-shadow: 0 6px 24px rgba(0,0,0,0.1);
    background: white; min-width: 260px;
  }
  input {
    font-size: 1.4rem; text-align: center;
    border: 1px solid #ddd; border-radius: 8px;
    padding: 6px 10px; width: 110px;
  }
  button {
    font-size: 1rem; margin-left: 8px;
    padding: 6px 12px; border: none; border-radius: 8px;
    background: #007aff; color: white; cursor: pointer;
  }
  button:hover { background: #0062d6; }
  .time {
    font-size: 3rem; margin: 20px 0;
  }
  .bar {
    height: 10px; width: 100%; background: #eee; border-radius: 8px; overflow: hidden;
  }
  .fill {
    height: 100%; width: 0; background: linear-gradient(90deg,#00b4ff,#007aff);
    transition: width 1s linear;
  }
</style>
</head>
<body>
  <div class="timer-box">
    <div>
      <input id="timeInput" type="text" placeholder="2 or 1:30">
      <button id="startBtn">Start</button>
    </div>
    <div class="time" id="display">00:00:00</div>
    <div class="bar"><div class="fill" id="fill"></div></div>
  </div>

<script>
let timer=null, total=0, startTime=0;
const display=document.getElementById('display');
const fill=document.getElementById('fill');

function parseTime(input){
  input=input.trim();
  if(!input) return 0;
  if(/^\d+$/.test(input)) {
    // только число => часы
    return parseInt(input,10)*3600;
  }
  const parts=input.split(':').map(x=>parseInt(x,10)||0);
  if(parts.length===2) {
    return parts[0]*3600 + parts[1]*60;
  }
  return 0;
}

function format(sec){
  const h=Math.floor(sec/3600), m=Math.floor(sec%3600/60), s=sec%60;
  return `${String(h).padStart(2,'0')}:${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
}

function tick(){
  const elapsed = Math.floor((Date.now() - startTime)/1000);
  const remaining = Math.max(0, total - elapsed);
  display.textContent = format(remaining);
  fill.style.width = (100 - remaining/total*100) + '%';
  if(remaining<=0){ clearInterval(timer); flash(); beep(); }
}

function flash(){
  document.body.style.background='#ffe6e6';
  setTimeout(()=>document.body.style.background='#fafafa',800);
}

function beep(){
  try{
    const ctx=new (window.AudioContext||window.webkitAudioContext)();
    const o=ctx.createOscillator(), g=ctx.createGain();
    o.type='sine'; o.frequency.setValueAtTime(800,ctx.currentTime);
    g.gain.setValueAtTime(0.1,ctx.currentTime);
    o.connect(g).connect(ctx.destination);
    o.start(); o.stop(ctx.currentTime+0.3);
  }catch(e){}
}

document.getElementById('startBtn').onclick=()=>{
  const t=parseTime(document.getElementById('timeInput').value);
  if(!t){ alert('Введите часы или ч:мм'); return; }
  total=t; startTime=Date.now();
  clearInterval(timer);
  tick(); timer=setInterval(tick,1000);
};
</script>
</body>
</html>
